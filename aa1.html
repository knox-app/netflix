<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Player</title>

<style>
html,body{margin:0;height:100%;background:#000;overflow:hidden;font-family:system-ui}
#app{position:relative;width:100%;height:100%}
video{
  width:100%;height:100%;
  object-fit:contain;
  background:#000;
  transition:transform .25s,filter .25s;
}
video.scale{object-fit:cover;transform:scale(1.2)}

.top{
  position:absolute;top:0;left:0;right:0;
  padding:14px;color:#fff;
  background:linear-gradient(#000c,transparent);
  z-index:10
}

.controls{
  position:absolute;left:0;right:0;bottom:0;
  padding:12px;
  background:linear-gradient(transparent,#000d);
  transition:.3s;
}
.controls.hide{opacity:0;pointer-events:none}

.seek-wrap{
  height:5px;background:#444;
  position:relative;
}
.seek{
  height:100%;width:0%;
  background:#1f80e0;
}
.thumb{
  position:absolute;top:-4px;
  width:12px;height:12px;
  background:#1f80e0;border-radius:50%;
  transform:translateX(-6px);
}

.row{display:flex;justify-content:space-between;margin-top:10px}
.btn{background:none;border:none}
.btn svg{width:26px;height:26px;fill:#fff}

.center{
  position:absolute;inset:0;
  display:flex;align-items:center;justify-content:center;
}
.center svg{width:64px;height:64px;fill:#fff}

.panel{
  position:absolute;right:12px;bottom:80px;
  background:#111;color:#fff;
  padding:10px;border-radius:8px;
  display:none;z-index:20
}
.panel button{
  width:100%;margin:4px 0;
  background:#222;color:#fff;border:none;padding:6px
}

.locked .controls,.locked .panel{display:none}
.lock-btn{
  position:absolute;left:14px;bottom:90px;z-index:30
}
</style>
</head>

<body>
<div id="app">

<video id="video" playsinline muted></video>

<div class="top" id="title">Live</div>

<div class="center" id="playBtn">
<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
</div>

<div class="lock-btn">
<button class="btn" id="lockBtn">
<svg viewBox="0 0 24 24">
<path d="M12 17a2 2 0 100-4 2 2 0 000 4zm6-7h-1V7a5 5 0 00-10 0v3H6a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2v-8z"/>
</svg>
</button>
</div>

<div class="controls" id="controls">
  <div class="seek-wrap" id="seekWrap">
    <div class="seek" id="seek"></div>
    <div class="thumb" id="thumb"></div>
  </div>

  <div class="row">
    <div>
      <button class="btn" id="muteBtn">
        <svg viewBox="0 0 24 24">
          <path d="M3 9v6h4l5 5V4L7 9H3z"/>
        </svg>
      </button>

      <button class="btn" id="liveBtn">
        <svg viewBox="0 0 24 24">
          <path d="M6 6h12v12H6z"/>
        </svg>
      </button>

      <button class="btn" id="settingsBtn">
        <svg viewBox="0 0 24 24">
          <path d="M19.14 12.94a7.97 7.97 0 000-1.88l2.03-1.58-1.92-3.32-2.39.96-.36-2.54h-3.84l-.36 2.54-2.39-.96-1.92 3.32 2.03 1.58a7.97 7.97 0 000 1.88l-2.03 1.58 1.92 3.32 2.39-.96.36 2.54h3.84l.36-2.54 2.39.96 1.92-3.32z"/>
        </svg>
      </button>
    </div>

    <button class="btn" id="fsBtn">
      <svg viewBox="0 0 24 24">
        <path d="M7 14H5v5h5v-2H7zm0-4h2V7h3V5H7zm10 9h-3v2h5v-5h-2zm0-14V5h-5v2h3v3z"/>
      </svg>
    </button>
  </div>
</div>

<div class="panel" id="settings">
  <button onclick="setSpeed(0.5)">0.5x</button>
  <button onclick="setSpeed(1)">1x</button>
  <button onclick="setSpeed(1.5)">1.5x</button>
  <button onclick="setSpeed(2)">2x</button>
</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
const video=document.getElementById("video");
const app=document.getElementById("app");
const controls=document.getElementById("controls");
const seek=document.getElementById("seek");
const thumb=document.getElementById("thumb");

/* LOAD */
const q=new URLSearchParams(location.search);
title.textContent=q.get("name")||"Live";
const src=q.get("src");
if(Hls.isSupported()){
 const h=new Hls({liveSyncDurationCount:3});
 h.loadSource(src);
 h.attachMedia(video);
 h.on(Hls.Events.MANIFEST_PARSED,()=>video.play());
}else video.src=src;

/* AUTOPLAY SOUND FIX */
let activated=false;
function activate(){
 if(!activated){
  video.muted=false;video.volume=1;activated=true;
 }
}
app.addEventListener("click",activate,{once:true});
app.addEventListener("touchstart",activate,{once:true});

/* PLAY */
playBtn.onclick=()=>video.play();
video.onplay=()=>playBtn.style.display="none";
video.onpause=()=>playBtn.style.display="flex";

/* SEEK DRAG */
let dragging=false;
seekWrap.addEventListener("pointerdown",e=>{
 dragging=true;
 seekMove(e);
});
window.addEventListener("pointermove",e=>dragging&&seekMove(e));
window.addEventListener("pointerup",()=>dragging=false);

function seekMove(e){
 const r=seekWrap.getBoundingClientRect();
 const p=Math.min(Math.max(0,e.clientX-r.left),r.width)/r.width;
 video.currentTime=p*video.duration;
}

/* UPDATE BAR */
video.ontimeupdate=()=>{
 const p=video.currentTime/video.duration*100;
 seek.style.width=p+"%";
 thumb.style.left=p+"%";
};

/* GO LIVE */
liveBtn.onclick=()=>{
 video.currentTime=video.duration;
};

/* FULLSCREEN */
fsBtn.onclick=()=>document.fullscreenElement?document.exitFullscreen():app.requestFullscreen();

/* CONTROLS WAKE */
let t;
function show(){
 controls.classList.remove("hide");
 clearTimeout(t);
 t=setTimeout(()=>!video.paused&&controls.classList.add("hide"),3000);
}
["click","touchstart","mousemove"].forEach(e=>app.addEventListener(e,show));
show();

/* SETTINGS */
settingsBtn.onclick=()=>settings.style.display=settings.style.display?"":"block";
function setSpeed(s){video.playbackRate=s;settings.style.display=""}

/* LOCK */
let locked=false;
lockBtn.onclick=()=>{
 locked=!locked;
 app.classList.toggle("locked",locked);
};

/* BRIGHTNESS & VOLUME SWIPE */
let sy=0;
app.addEventListener("touchstart",e=>sy=e.touches[0].clientY,{passive:true});
app.addEventListener("touchmove",e=>{
 const dy=sy-e.touches[0].clientY;
 const x=e.touches[0].clientX;
 if(x<innerWidth/2){
  let b=Math.min(1.5,Math.max(.5,1+dy/300));
  video.style.filter=`brightness(${b})`;
 }else{
  video.volume=Math.min(1,Math.max(0,video.volume+dy/500));
 }
},{passive:true});

/* PINCH SCALE ONLY */
let sd=0,sc=false;
function dist(t){let dx=t[0].clientX-t[1].clientX,dy=t[0].clientY-t[1].clientY;return Math.sqrt(dx*dx+dy*dy)}
video.addEventListener("touchstart",e=>{if(e.touches.length==2)sd=dist(e.touches)},{passive:true});
video.addEventListener("touchmove",e=>{
 if(e.touches.length==2){
  let d=dist(e.touches)-sd;
  if(d>40&&!sc){video.classList.add("scale");sc=true}
  if(d<-40&&sc){video.classList.remove("scale");sc=false}
 }
},{passive:true});
</script>
</body>
</html>

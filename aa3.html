<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TV Player Fixed</title>
    <style>
        :root { --primary: #0078ff; --surface: #121212; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: sans-serif; color: white; }
        
        /* Loading Spinner */
        #loader {
            position: absolute; inset: 0; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; background: #000; z-index: 99;
        }
        .spinner {
            width: 60px; height: 60px; border: 5px solid #333; border-top-color: var(--primary);
            border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Start Screen (Fixes Autoplay) */
        #start-screen {
            position: absolute; inset: 0; background: rgba(0,0,0,0.9);
            z-index: 100; display: flex; align-items: center; justify-content: center;
        }
        .start-btn {
            padding: 20px 40px; font-size: 24px; background: var(--primary);
            color: white; border: none; border-radius: 10px; cursor: pointer;
        }

        video { width: 100%; height: 100%; }

        /* Simple UI */
        .info { position: absolute; top: 40px; left: 40px; z-index: 10; text-shadow: 2px 2px 10px #000; }
        #error-msg { color: #ff4444; font-size: 14px; margin-top: 10px; max-width: 400px; }
        
        /* Focus state for TV */
        button:focus { outline: 4px solid white; transform: scale(1.1); }
    </style>
</head>
<body>

    <!-- Start Screen -->
    <div id="start-screen">
        <button class="start-btn" id="init-btn">Click to Start Player</button>
    </div>

    <!-- Loading Screen -->
    <div id="loader" style="display:none;">
        <div class="spinner"></div>
        <div id="loading-text">Buffering Live Stream...</div>
        <div id="error-msg"></div>
    </div>

    <div class="info">
        <h1 id="title" style="margin:0">Live TV</h1>
        <div id="status">Ready</div>
    </div>

    <video id="video" playsinline></video>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
    const video = document.getElementById('video');
    const loader = document.getElementById('loader');
    const errorMsg = document.getElementById('error-msg');
    const statusText = document.getElementById('status');
    const startScreen = document.getElementById('start-screen');
    const initBtn = document.getElementById('init-btn');

    // TEST CHANNELS (Using reliable m3u8 sources)
    const testStream = "https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8";

    function startPlayer() {
        startScreen.style.display = 'none';
        loader.style.display = 'flex';
        statusText.innerText = "Connecting...";
        
        if (Hls.isSupported()) {
            const hls = new Hls({
                debug: false,
                enableWorker: true,
                lowLatencyMode: true
            });

            hls.loadSource(testStream);
            hls.attachMedia(video);

            hls.on(Hls.Events.MANIFEST_PARSED, () => {
                statusText.innerText = "Manifest Loaded. Playing...";
                video.play().catch(e => {
                    errorMsg.innerText = "Autoplay blocked. Please click the screen.";
                });
            });

            // ERROR HANDLING
            hls.on(Hls.Events.ERROR, (event, data) => {
                if (data.fatal) {
                    switch (data.type) {
                        case Hls.ErrorTypes.NETWORK_ERROR:
                            errorMsg.innerText = "Network Error: Cannot fetch stream (CORS or 404).";
                            hls.startLoad();
                            break;
                        case Hls.ErrorTypes.MEDIA_ERROR:
                            errorMsg.innerText = "Media Error: Decoding failed.";
                            hls.recoverMediaError();
                            break;
                        default:
                            errorMsg.innerText = "Fatal Error: Unplayable stream.";
                            hls.destroy();
                            break;
                    }
                }
            });

        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            // For Safari/iOS
            video.src = testStream;
            video.play();
        }
    }

    // Video Events to hide/show loader
    video.onwaiting = () => { loader.style.display = 'flex'; };
    video.onplaying = () => { 
        loader.style.display = 'none'; 
        statusText.innerText = "Live";
    };

    // User must click once to allow audio on TV/Browsers
    initBtn.onclick = startPlayer;
    initBtn.focus(); // Focus button immediately for TV Remote

    // Remote Control Shortcut: Press Enter to start
    window.addEventListener('keydown', (e) => {
        if(e.key === "Enter" && startScreen.style.display !== 'none') {
            startPlayer();
        }
    });

</script>
</body>
</html>

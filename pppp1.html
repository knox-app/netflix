<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <title>Instant TV</title>
    <style>
        :root { --accent: #e50914; /* Netflix Red */ --ui-step: 0.1s; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: #000; overflow: hidden; 
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        }

        #app { position: relative; width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center; background: #000; }

        /* INSTANT VIDEO ZOOM */
        #video-stage { width: 100%; height: 100%; transition: transform var(--ui-step) ease-out; }
        video { width: 100%; height: 100%; object-fit: contain; }
        .is-zoomed video { object-fit: cover; }

        /* UI LAYERS */
        .overlay { 
            position: absolute; inset: 0; z-index: 10; 
            background: radial-gradient(circle, transparent 20%, rgba(0,0,0,0.4) 100%), 
                        linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 20%),
                        linear-gradient(to bottom, rgba(0,0,0,0.8) 0%, transparent 20%);
            transition: opacity var(--ui-step);
            display: flex; flex-direction: column; justify-content: space-between;
        }
        .hidden { opacity: 0; pointer-events: none; }

        /* LOCK STATE */
        #lock-guard { position: absolute; inset: 0; z-index: 50; display: none; }
        body.locked #lock-guard { display: block; }
        body.locked .overlay { opacity: 0; pointer-events: none; }

        /* BUTTONS (Production Size 24px) */
        .btn { 
            background: none; border: none; cursor: pointer; padding: 12px;
            display: flex; align-items: center; justify-content: center;
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.9); }
        .btn svg { width: 24px; height: 24px; fill: #fff; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5)); }

        /* TOP & BOTTOM BARS */
        .top { padding: 20px 30px; display: flex; align-items: center; justify-content: space-between; }
        .bottom { padding: 0 30px 40px 30px; }

        /* LIVE STATUS & BUTTON */
        #go-live {
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3);
            color: #fff; padding: 4px 10px; border-radius: 4px; font-size: 11px;
            font-weight: bold; letter-spacing: 1px; cursor: pointer;
            display: none; align-items: center; gap: 6px; margin-bottom: 15px;
        }
        #go-live.visible { display: inline-flex; }
        .live-dot { width: 6px; height: 6px; background: #666; border-radius: 50%; }
        .is-live .live-dot { background: #ff0000; box-shadow: 0 0 5px #ff0000; }

        /* PROGRESS BAR (Netflix Thin) */
        .seek-wrap { width: 100%; height: 20px; display: flex; align-items: center; cursor: pointer; position: relative; }
        .seek-rail { width: 100%; height: 3px; background: rgba(255,255,255,0.3); border-radius: 2px; }
        #seek-fill { position: absolute; height: 3px; background: var(--accent); width: 0%; border-radius: 2px; }
        #seek-handler { 
            position: absolute; top: 50%; transform: translate(-50%, -50%);
            width: 14px; height: 14px; background: var(--accent); border-radius: 50%;
            display: none;
        }
        .seek-wrap:active #seek-handler { display: block; }
        .seek-wrap:active .seek-rail { height: 4px; }

        /* CENTER FEEDBACK (Play/Pause/Skip) */
        #feedback {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            pointer-events: none; z-index: 20; opacity: 0;
        }
        .show-fb { animation: instantPop 0.4s ease-out; }
        @keyframes instantPop { 
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1.2); }
        }

        /* LOADING */
        #loader { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; z-index: 100; background: #000; transition: opacity 0.2s; }
        .spinner { width: 40px; height: 40px; border: 3px solid rgba(255,255,255,0.2); border-top-color: var(--accent); border-radius: 50%; animation: s 0.6s linear infinite; }
        @keyframes s { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="is-live">

<div id="app">
    <div id="loader"><div class="spinner"></div></div>
    <div id="lock-guard"></div>

    <div id="video-stage">
        <video id="video" playsinline></video>
    </div>

    <div id="feedback"><svg style="width: 60px; height: 60px; fill: #fff;" viewBox="0 0 24 24"><path id="fb-path" d="M8 5v14l11-7z"/></svg></div>

    <div class="overlay" id="ui">
        <div class="top">
            <button class="btn" id="lock-btn">
                <svg id="lock-svg" viewBox="0 0 24 24"><path d="M12 17c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm6-9h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9V6z"/></svg>
            </button>
            <span id="title" style="color:#fff; font-size: 14px; font-weight: 500;">LIVE STREAM</span>
            <div style="width:40px"></div> <!-- spacer -->
        </div>

        <div class="bottom">
            <button id="go-live"><div class="live-dot"></div> GO LIVE</button>
            
            <div class="seek-wrap" id="seek-bar">
                <div class="seek-rail"></div>
                <div id="seek-fill"></div>
                <div id="seek-handler"></div>
            </div>

            <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 10px;">
                <div style="display: flex; gap: 15px;">
                    <button class="btn" id="play-pause"><svg id="pp-svg" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></button>
                    <button class="btn" id="back-10"><svg viewBox="0 0 24 24"><path d="M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"/></svg></button>
                </div>
                <button class="btn" id="fs-toggle"><svg viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7zm0-4h2V7h3V5H7zm10 9h-3v2h5v-5h-2zm0-14V5h-5v2h3v3z"/></svg></button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
    const video = document.getElementById('video');
    const ui = document.getElementById('ui');
    const playBtn = document.getElementById('play-pause');
    const lockBtn = document.getElementById('lock-btn');
    const liveBtn = document.getElementById('go-live');
    const seekFill = document.getElementById('seek-fill');
    const handle = document.getElementById('seek-handler');

    let locked = false;
    let uiT;

    /* --- INSTANT STREAM LOAD --- */
    const src = new URLSearchParams(window.location.search).get('src') || "https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8";
    if (Hls.isSupported()) {
        const hls = new Hls({ enableWorker: true, lowLatencyMode: true });
        hls.loadSource(src); hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
    }

    /* --- INSTANT PINCH ZOOM (SNAP) --- */
    let lastDist = 0;
    document.addEventListener('touchmove', (e) => {
        if (e.touches.length === 2 && !locked) {
            let d = Math.hypot(e.touches[0].pageX - e.touches[1].pageX, e.touches[0].pageY - e.touches[1].pageY);
            if (lastDist > 0) {
                if (d > lastDist + 40) document.body.classList.add('is-zoomed');
                if (d < lastDist - 40) document.body.classList.remove('is-zoomed');
            }
            lastDist = d;
        }
    }, { passive: true });
    document.addEventListener('touchend', () => lastDist = 0);

    /* --- LIVE DETECTION --- */
    video.ontimeupdate = () => {
        if (!video.duration) return;
        const p = (video.currentTime / video.duration) * 100;
        seekFill.style.width = p + "%";
        handle.style.left = p + "%";

        // If behind more than 10s, show Live button
        if (video.duration - video.currentTime > 10) {
            liveBtn.classList.add('visible');
            document.body.classList.remove('is-live');
        } else {
            liveBtn.classList.remove('visible');
            document.body.classList.add('is-live');
        }
    };
    liveBtn.onclick = () => { video.currentTime = video.duration - 0.5; };

    /* --- LOCK SYSTEM (Instant) --- */
    lockBtn.onclick = (e) => {
        e.stopPropagation();
        locked = !locked;
        document.body.classList.toggle('locked', locked);
        document.getElementById('lock-svg').innerHTML = locked ? 
            '<path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9V6z"/>' : 
            '<path d="M12 17c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm6-9h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9V6z"/>';
        if (!locked) showUI();
    };

    /* --- INSTANT SEEK --- */
    let scrubbing = false;
    const doScrub = (e) => {
        if (locked) return;
        const rect = document.getElementById('seek-bar').getBoundingClientRect();
        const x = (e.clientX || (e.touches ? e.touches[0].clientX : 0)) - rect.left;
        video.currentTime = (Math.min(Math.max(0, x / rect.width), 1)) * video.duration;
    };
    document.getElementById('seek-bar').onmousedown = (e) => { scrubbing = true; doScrub(e); };
    window.onmousemove = (e) => scrubbing && doScrub(e);
    window.onmouseup = () => scrubbing = false;
    // Touch support
    document.getElementById('seek-bar').ontouchstart = (e) => { scrubbing = true; doScrub(e); };
    window.ontouchmove = (e) => scrubbing && doScrub(e);
    window.ontouchend = () => scrubbing = false;

    /* --- UI & FEEDBACK --- */
    function showUI() {
        if (locked) return;
        ui.classList.remove('hidden');
        clearTimeout(uiT);
        if (!video.paused) uiT = setTimeout(() => ui.classList.add('hidden'), 3000);
    }
    
    function triggerFeedback(path) {
        const fb = document.getElementById('feedback');
        document.getElementById('fb-path').setAttribute('d', path);
        fb.classList.remove('show-fb');
        void fb.offsetWidth;
        fb.classList.add('show-fb');
    }

    function togglePlay() {
        if (locked) return;
        if (video.paused) {
            video.play();
            triggerFeedback("M8 5v14l11-7z");
        } else {
            video.pause();
            triggerFeedback("M6 19h4V5H6v14zm8-14v14h4V5h-4z");
        }
    }

    playBtn.onclick = togglePlay;
    document.getElementById('app').onclick = showUI;
    document.getElementById('back-10').onclick = () => { video.currentTime -= 10; triggerFeedback("M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"); };
    document.getElementById('fs-toggle').onclick = () => { document.fullscreenElement ? document.exitFullscreen() : app.requestFullscreen(); };

    video.onplaying = () => { 
        document.getElementById('loader').style.opacity = '0'; 
        setTimeout(()=> document.getElementById('loader').style.display = 'none', 200);
        document.getElementById('pp-svg').innerHTML = '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>';
    };
    video.onpause = () => {
        document.getElementById('pp-svg').innerHTML = '<path d="M8 5v14l11-7z"/>';
        showUI();
    };
    video.onwaiting = () => { document.getElementById('loader').style.display = 'flex'; document.getElementById('loader').style.opacity = '1'; };

    // Remote Keys
    window.onkeydown = (e) => {
        showUI();
        if (locked && e.key !== "Enter") return;
        if (e.key === "Enter") togglePlay();
        if (e.key === "ArrowRight") video.currentTime += 10;
        if (e.key === "ArrowLeft") video.currentTime -= 10;
    };
</script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Player</title>

<style>
html,body{
  margin:0;
  height:100%;
  background:#000;
  overflow:hidden;
  font-family:system-ui,Roboto,Arial;
}
#app{
  position:relative;
  width:100%;
  height:100%;
}
video{
  width:100%;
  height:100%;
  object-fit:contain;
  background:#000;
  transition:transform .25s ease, object-fit .25s ease;
}

/* pinch scale ONLY */
video.scale{
  object-fit:cover;
  transform:scale(1.2);
}

/* top bar */
.top{
  position:absolute;
  top:0;left:0;right:0;
  padding:14px;
  background:linear-gradient(#000c,transparent);
  color:#fff;
  z-index:10;
}

/* controls */
.controls{
  position:absolute;
  left:0;right:0;bottom:0;
  padding:12px;
  background:linear-gradient(transparent,#000d);
  transition:.3s;
}
.controls.hide{opacity:0;pointer-events:none}

/* seek */
.seek-wrap{
  height:4px;
  background:#444;
}
.seek{
  height:100%;
  width:0%;
  background:#1f80e0;
}

/* buttons */
.row{
  display:flex;
  justify-content:space-between;
  margin-top:10px;
}
.btn{
  background:none;
  border:none;
}
.btn svg{
  width:26px;
  height:26px;
  fill:#fff;
}

/* center play */
.center{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
}
.center svg{width:64px;height:64px;fill:#fff}

/* preview */
.preview{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  color:#fff;
  font-size:18px;
  display:none;
}

/* lock */
.locked *{pointer-events:none}
</style>
</head>

<body>
<div id="app">

<video id="video" playsinline muted></video>

<div class="top" id="title">Live</div>

<div class="center" id="playBtn">
<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
</div>

<div class="preview" id="preview">+10s</div>

<div class="controls" id="controls">
  <div class="seek-wrap" id="seekWrap">
    <div class="seek" id="seek"></div>
  </div>

  <div class="row">
    <div>
      <button class="btn" id="muteBtn">
        <svg id="muteIcon" viewBox="0 0 24 24">
          <path d="M3 9v6h4l5 5V4L7 9H3z"/>
        </svg>
      </button>
      <button class="btn" id="lockBtn">
        <svg viewBox="0 0 24 24">
          <path d="M12 17a2 2 0 100-4 2 2 0 000 4zm6-7h-1V7a5 5 0 00-10 0v3H6a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2v-8a2 2 0 00-2-2z"/>
        </svg>
      </button>
    </div>
    <div>
      <button class="btn" id="fsBtn">
        <svg viewBox="0 0 24 24">
          <path d="M7 14H5v5h5v-2H7zm0-4h2V7h3V5H7zm10 9h-3v2h5v-5h-2zm0-14V5h-5v2h3v3z"/>
        </svg>
      </button>
    </div>
  </div>
</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
const video=document.getElementById("video");
const controls=document.getElementById("controls");
const playBtn=document.getElementById("playBtn");
const preview=document.getElementById("preview");
const app=document.getElementById("app");

/* load */
const q=new URLSearchParams(location.search);
title.textContent=q.get("name")||"Live";
const src=q.get("src");
if(Hls.isSupported()){
 const h=new Hls();
 h.loadSource(src);
 h.attachMedia(video);
 h.on(Hls.Events.MANIFEST_PARSED,()=>video.play());
}else video.src=src;

/* autoplay muted works */
video.play();

/* unmute FIX */
let activated=false;
function activate(){
 if(!activated){
  video.muted=false;
  video.volume=1;
  activated=true;
 }
}
app.addEventListener("touchstart",activate,{once:true});
app.addEventListener("click",activate,{once:true});

/* play pause */
playBtn.onclick=()=>video.play();
video.onplay=()=>playBtn.style.display="none";
video.onpause=()=>playBtn.style.display="flex";

/* seek */
video.ontimeupdate=()=>{
 seek.style.width=(video.currentTime/video.duration*100)+"%";
};

/* double tap seek */
let last=0;
app.onclick=e=>{
 const now=Date.now();
 if(now-last<300){
  const dir=e.clientX>innerWidth/2?10:-10;
  video.currentTime+=dir;
  preview.textContent=(dir>0?"+10s":"-10s");
  preview.style.display="block";
  setTimeout(()=>preview.style.display="none",600);
 }
 last=now;
};

/* fullscreen */
fsBtn.onclick=()=>{
 document.fullscreenElement?
 document.exitFullscreen():
 app.requestFullscreen();
};

/* mute */
muteBtn.onclick=()=>{
 video.muted=!video.muted;
};

/* lock */
let locked=false;
lockBtn.onclick=()=>{
 locked=!locked;
 app.classList.toggle("locked",locked);
 controls.style.display=locked?"none":"";
};

/* controls visibility */
let t;
function show(){
 controls.classList.remove("hide");
 clearTimeout(t);
 t=setTimeout(()=>{if(!video.paused)controls.classList.add("hide")},3000);
}
["touchstart","mousemove","click"].forEach(e=>app.addEventListener(e,show));
show();

/* pinch SCALE ONLY */
let start=0,scaled=false;
function dist(t){
 let dx=t[0].clientX-t[1].clientX;
 let dy=t[0].clientY-t[1].clientY;
 return Math.sqrt(dx*dx+dy*dy);
}
video.addEventListener("touchstart",e=>{
 if(e.touches.length==2) start=dist(e.touches);
},{passive:true});
video.addEventListener("touchmove",e=>{
 if(e.touches.length==2){
  let d=dist(e.touches)-start;
  if(d>40&&!scaled){video.classList.add("scale");scaled=true;}
  if(d<-40&&scaled){video.classList.remove("scale");scaled=false;}
 }
},{passive:true});
</script>
</body>
</html>
